<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>QTools: QUTest&trade; Unit Testing Harness</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="ql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
  <a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">
    <img id="logo" src="img/logo_ql.png" alt="Quantum Leaps">
  </a>
  <span id="projectname">QTools</span>
  <span id="projectnumber">6.9.3</span>
           <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)"
               onblur="searchBox.OnSearchFieldFocus(false)"
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;"
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('qutest.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0"
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">QUTest&trade; Unit Testing Harness </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="image">
<img src="qutest_banner.jpg" alt=""/>
</div>
<p><a class="el" href="qutest_tut.html">&#160;</a> <a class="el" href="qutest_rtc.html">&#160;</a> <a class="el" href="qutest_fixture.html">&#160;</a> <a class="el" href="qutest_script.html">&#160;</a></p>
<h1><a class="anchor" id="qutest_about"></a>
About QUTestâ„¢</h1>
<p><b>QUTest&trade;</b> (pronounced "cutest") is a <b>unit testing harness</b> (a.k.a. <em>unit testing framework</em>), which is specifically designed for deeply embedded systems, but also supports unit testing of embedded code on host computers ("dual targeting"). QUTest&trade; is the fundamental tooling for <a href="https://en.wikipedia.org/wiki/Test-driven_development" target="_blank" class="extern"><b>Test-Driven Development (TDD)</b></a> of <a href="https://www.state-machine.com/products/#QP" target="_blank" class="extern">QP/C/C++ applications</a>, which is a highly recommended best-practice. </p>
<dl class="section note"><dt>Note</dt><dd>Even though QUTest&trade; has been primarily designed for testing of <a href="https://www.state-machine.com/doc/concepts#Event-Driven" target="_blank" class="extern">event-driven systems</a>, it can also be used to test <b>any embedded C or C++ code</b>. To demonstrate this capability, the QUTest&trade; comes with a few examples from the conventional <a href="http://www.throwtheswitch.org/unity" target="_blank" class="extern">Unity testing framework</a>, which among others demonstrate such techniques as using <a href="https://martinfowler.com/bliki/TestDouble.html" target="_blank" class="extern">test doubles</a> and <a href="https://en.wikipedia.org/wiki/Mock_object" target="_blank" class="extern">mocks</a> with QUTest&trade;.</dd></dl>
<h2><a class="anchor" id="qutest_how"></a>
How it works?</h2>
<p>In a nutshell, working with QUTest&trade; is similar to "debugging with printf" (or <code>sprintf</code> or similar), where you instrument the code to output information about its execution. You then run the code with a controlled set of inputs, and examine the produced output from the <code>printf</code>s to determine whether the code under test operates correctly. The main differences from using <code>printf</code>s are: (1) that the much more efficient <a class="el" href="qpspy.html">QP/Spy</a> output mechanism is used instead and (2) that both generating the inputs and the checking of the test outputs are <b>automated</b>.</p>
<p>The process of testing embedded code with QUTest&trade; involves the following components:</p>
<ol type="1">
<li>The <b>Target</b> that runs an instrumented <a class="el" href="qutest_fixture.html">test fixture</a> code, whose job is to exercise your <b>CUT</b> (<b>C</b>ode <b>U</b>nder <b>T</b>est). Please note that a <em>test fixture</em> only exercises the CUT and reports the results to the host using <a class="el" href="qpspy.html">QP/Spy</a>, but the <em>test fixture</em> does <b>not</b> check if the CUT operates "correctly".<br  />
<blockquote class="doxtable">
<p>NOTE: Several examples of <em>test fixtures</em> are explained in the <a class="el" href="qutest_tut.html">QUTest Tutorial</a>. The details of <em>test fixtures</em> are described in <a class="el" href="qutest_fixture.html">QUTest Fixture Reference</a>. </p>
</blockquote>
</li>
<li>The <a class="el" href="qspy.html">QSPY</a> "back-end" application that receives the tracing data from the Target and also opens a communication channel for the QUTest "front-end".</li>
<li>The <b>QUTest</b> "front-end" that executes <a class="el" href="qutest_script.html">test scripts</a>, which drive the tests and check the QSPY output against the expectations ("test-assertions").<br  />
<blockquote class="doxtable">
<p>NOTE: Several examples of <em>test scripts</em> are explained in the <a class="el" href="qutest_tut.html">QUTest Tutorial</a>. The details of <em>test scripts</em> are described in <a class="el" href="qutest_script.html">QUTest Script Reference</a>. </p>
</blockquote>
</li>
</ol>
<p><br  />
</p><div class="image">
<img src="qutest_targ.gif" alt=""/>
<div class="caption">
Communication between Target, QSPY, and QUTest</div></div>
<dl class="section remark"><dt>Remarks</dt><dd>The separation between CUT execution and checking the test results has many benefits. One of the most important ones is that CUT execution (<em>test fixture</em>) and checking the results (<em>test script</em>) can be done in <em>different programming languages</em>. To this end QUTest&trade; provides support for writing the <a class="el" href="qutest_script.html">test scripts in Python</a>. <br  />
<div class="image">
<img src="img/logo_python3.gif" alt=""/>
</div>
</dd></dl>
<p>The general QUTest&trade; structure just described corresponds to running tests on an embedded Target. But QUTest&trade; can also execute tests on the <b>host computer</b>. In that case (shown in the figure below), the <b>test fixture</b> is a host executable that communicates with the QSPY host application via a TCP/IP socket (QSPY started with the <code>-t</code> <a class="el" href="qspy.html#qspy_command">command-line option</a>). In this case all QUTest&trade; components execute on the host computer.</p>
<div class="image">
<img src="qutest_host.gif" alt=""/>
<div class="caption">
QUTest with Host Executable</div></div>
<dl class="section remark"><dt>Remarks</dt><dd>To work effectively with QUTest&trade;, you need to understand <b>how much output to expect from any given input</b>. Additionally, you need to understand how QUTest ensures that for every input to the <em>test fixture</em>, the generated QSPY output matches all test expectations and that there are no extra expectations or missing expectations after every command from the <em>test script</em>. These subjects are explained in the section <a class="el" href="qutest_rtc.html">Run-to-Completion Processing</a>.</dd></dl>
<h2><a class="anchor" id="qutest_special"></a>
What's Special about QUTestâ„¢?</h2>
<p>Unlike other existing unit testing harnesses for embedded systems (e.g., <a href="http://www.throwtheswitch.org/white-papers/unity-intro.html" target="_blank" class="extern">Unity</a> or <a href="http://cpputest.github.io/" target="_blank" class="extern">CppUTest</a>) QUTest&trade; is <b>not based on</b> <a href="https://en.wikipedia.org/wiki/XUnit" target="_blank" class="extern"><b>xUnit</b></a> that was originally designed to run tests on host computers. Instead, QUTest&trade; is geared towards unit testing of <b>deeply embedded systems</b>. Here is a list of QUTest&trade; unique features, specifically designed for this purpose:</p>
<ul>
<li>QUTest&trade; separates the <em>execution</em> of the CUT (Code Under Test) from <em>checking</em> of the "test assertions". The embedded target is concerned only with running a <a class="el" href="qutest_fixture.html">test fixture</a> that exercises the CUT and produces QP/Spy&trade; trace, but it does <em>not</em> check the "test assertions". Checking the "test assertions" against the expectations is performed on the host computer by means of <a class="el" href="qutest_script.html">test scripts</a>.</li>
<li>The QUTest&trade; approach is more <b>intuitive for embedded developers</b>, because it is conceptually like automated "debugging by printf" that most embedded developers use extensively. As it turns out, this approach also simplifies the development of all sorts of <a href="https://martinfowler.com/bliki/TestDouble.html" target="_blank" class="extern">test doubles</a>, including <a href="https://en.wikipedia.org/wiki/Mock_object" target="_blank" class="extern">mocks</a>, <em>without breaking encapsulation</em> of the CUT.</li>
<li>QUTest&trade; is a unique test harness on the embedded market that supports <b>scripting</b>. QUTest <a class="el" href="qutest_script.html">test scripts</a> run on the Host, which skips compilation and uploading the code to the Target and thus shortens the TDD micro-cycle.</li>
</ul>
<blockquote class="doxtable">
<p><b>NOTE:</b> QUTest&trade; supports <em>test scripts</em> written in <a href="https://www.python.org">Python</a> (3.3+). </p>
</blockquote>
<ul>
<li>QUTest&trade; supports <b>resetting the Target</b> for each individual test, if needed. This goes far beyond providing test <code>setup()</code> and <code>teardown()</code> functions that other test fixtures offer (and of course QUTest supports as well). Clean reset of the Target avoids erroneous tests that implicitly rely on side effects from previously executed code. This is particularly important for embedded systems and for state machines, so that each test can start from a known reset condition.</li>
<li>QUTest&trade; supports <b>testing Design by Contract</b> (assertions in C or C++, not to be confused with "test assertions") in the CUT. This is a carefully designed, unique feature of QUTest not available in other test harnesses. A successful test of DbC might actually mean breaking an assertion in the Target code.</li>
<li>QUTest&trade; <a class="el" href="qutest_fixture.html">test fixtures</a> that run on the Target <b>do not require dynamic memory</b> allocation (<code>malloc()/free()</code> in C or <code>new/delete</code> in C++). This means that you don't need to commit any of your precious embedded RAM to the heap (you can set the heap size to zero) and you don't need to link the heap management code. Avoiding dynamic memory allocation is one of the best practices of real-time embedded programming, which you don't need to compromise to run QUTest.</li>
<li>QUTest&trade; <a class="el" href="qutest_fixture.html">test fixtures</a> that run on the Target <b>do not require non-local jumps</b> (<code>setjmp()()/longjmp()</code> in C or <code>throw/catch</code> in C++), which are needed by other test harnesses to discontinue failing tests. QUTest&trade; <em>test fixtures</em> do not need to discontinue failing tests, because they don't check "testing assertions", so a <em>test fixture does</em> not "know" if it is failing or passing. Should a test fixture crash on the Target, it simply waits for the target reset commanded by a <a class="el" href="qutest_script.html">test script</a>.</li>
<li>QUTest&trade; <a class="el" href="qutest_fixture.html">test fixtures</a> can be based on the actual <b>application code</b>. For example you can reuse the same <code><a class="el" href="namespaceqview.html#a0ac274e7bffb2a1b29949100cd43ca35">main()</a></code> function in a <em>test fixture</em> and in your final application. This means that you can either grow your <em>test fixture</em> into a final application through TDD, or you can more easily add unit tests to an existing application.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Even though QUTest&trade; is particularly suitable for running tests on deeply embedded targets, it also fully supports running <em>the same</em> tests on your <b>host computer</b> (Windows, Linux, and MacOS are supported). In fact, running the tests as much as possible on the host and thus avoiding the target-hardware bottleneck is the highly recommended best-practice of embedded TDD. QUTest&trade; supports <b>fully-automated</b> unit testing, both on the embedded target and on the host computer.</dd></dl>
<h1><a class="anchor" id="qutest_use"></a>
Installation &amp; Use</h1>
<p>The <span class="img file_py">qutest.py</span> script can be used standalone, without any installation in your Python system (see <a class="el" href="qutest.html#qutest_run">Running QUTest&trade;</a> below).</p>
<dl class="section note"><dt>Note</dt><dd>The <span class="img file_py">qutest.py</span> script is included in the <a class="el" href="index.html#qtools_about">QTools&trade; collection</a>. Also, the <a class="el" href="index.html#qtools_win">QTools&trade; collection for Windows</a> already includes Python (3.8), so you don't need to install anything extra.</dd></dl>
<p>Alternatively, you can use *your own Python** installation, into which you can install the latest QUTest&trade; with <code>pip</code> from the <a href="https://pypi.org/project/qutest/"><b>PyPi index</b></a> by executing the following command:</p>
<pre class="fragment">pip install qutest
</pre><h2><a class="anchor" id="qutest_run"></a>
Running QUTestâ„¢</h2>
<p>If you are using QUTest&trade; as a standalone Python script, you invoke it as follows:</p>
<pre class="fragment">python3 &lt;path-to-qutest-script&gt;/qutest.py [-x] [test-scripts] [host_exe] [qspy_host[:udp_port]] [qspy_tcp_port]
</pre><p>Alternatively, if you've installed QView&trade; with <code>pip</code>, you invoke it as follows:</p>
<pre class="fragment">qutest [-x] [test-scripts] [host_exe] [qspy_host[:udp_port]] [qspy_tcp_port]
</pre><h2><a class="anchor" id="qutest_command"></a>
Command-line Options</h2>
<ul>
<li><code>-x</code> - optional flag that causes qutest to exit on first test failure.</li>
<li><code>test_scripts</code> - optional specification of the Python test scripts to run. If not specified, qutest will try to run all *.py files in the current directory as test scripts</li>
<li><code>host_exe | "" | DEBUG</code> - optional specification of the test-fixture compiled for the host (host executable) for testing on the host computer. The placeholder value <code>""</code> (empty string) can be used for running test fixtures on an embedded Target. The special value DEBUG means that qutest will run in the "debug mode", in which it will NOT launch the host executables and it will wait for the Target reset and other responses from the Target. If host_exe is not specified, an embedded target is assumed (which is loaded with the test fixture already).</li>
<li><code>qspy_host[:udp_port]</code> - optional host-name/IP-address:port for the host running the QSPY host utility. If not specified, the default is 'localhost:7701'.</li>
<li><code>tcp_port</code>- optional the QSpy TCP port number for connecting host executables. If not specified, the default is <code>6601</code>.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>The command-line options for <code>qutest.py</code> are <b>positional</b>, meaning that an option must be at the specific position in the command-line to be parsed correctly. For example, if you wish to run QUTest on an embedded target at the specified <code>[qspy_host]</code> host-name, you still need to provide a placeholder for the host executable <code>[host_exe]</code> ("") option, to get to the right position for the <code>[qspy_host]</code> option.</dd></dl>
<h2><a class="anchor" id="qutest_exa"></a>
Examples</h2>
<p><span class="logo logo_win">Windows Hosts</span></p>
<pre class="fragment">python3 %QTOOLS%\qutest\qutest.py
</pre><p>runs all the test scripts (<code>*.py</code>) in the current directory.</p>
<pre class="fragment">python3 %QTOOLS%\qutest\qutest.py *.py
</pre><p>runs the test scripts (<code>*.py</code>) in the current directory.</p>
<pre class="fragment">python3 %QTOOLS%\qutest\qutest.py *.py build\dpp.exe
</pre><p>runs the test scripts (<code>*.py</code>) in the current directory and uses the host executable: <code>build\dpp.exe</code></p>
<pre class="fragment">python3 %QTOOLS%\qutest\qutest.py *.py "" 192.168.1.100:7705
</pre><p>runs the test scripts (<code>*.py</code>) in the current directory, without a host executable: (<code>""</code>), and connects to QSPY at <code>192.168.1.100:7705</code></p>
<pre class="fragment">qutest *.py build\dpp.exe 192.168.1.100:7705
</pre><p>runs "qutest" (<b>installed with pip</b>) to execute the test scripts (<code>*.py</code>) in the current directory, uses the host executable: <code>build\dpp.exe</code>, and connects to QSPY at <code>192.168.1.100:7705</code></p>
<pre class="fragment">qutest *.py build\dpp.exe localhost:7701 6605
</pre><p>runs "qutest" (<b>installed with pip</b>) to execute the test scripts (<code>*.py</code>) in the current directory, uses the host executable: <code>build\dpp.exe</code>, and connects to QSPY at <code>localhost:7701</code>, using the local UDP port <code>6605</code></p>
<p><span class="logo logo_linux"></span><span class="logo logo_macos">Linux/MacOS Hosts</span></p>
<pre class="fragment">python3 $(QTOOLS)/qutest/qutest.py
</pre><p>runs all the test scripts (<code>*.py</code>) in the current directory.</p>
<pre class="fragment">python3 $(QTOOLS)/qutest/utest.py *.py
</pre><p>runs the test scripts (<code>*.py</code>) in the current directory.</p>
<pre class="fragment">python3 $(QTOOLS)/qutest/qutest.py *.py build/dpp
</pre><p>runs the test scripts (<code>*.py</code>) in the current directory and uses the host executable: <code>build/dpp</code></p>
<pre class="fragment">python3 $(QTOOLS)/qutest/utest.py *.py "" 192.168.1.100:7705
</pre><p>runs the test scripts (<code>*.py</code>) in the current directory, without a host executable: (<code>""</code>), and connects to QSPY at <code>192.168.1.100:7705</code></p>
<pre class="fragment">qutest *.py build/dpp 192.168.1.100:7705
</pre><p>runs "qutest" (<b>installed with pip</b>) to execute the test scripts (<code>*.py</code>) in the current directory, uses the host executable: <code>build/dpp</code>, and connects to QSPY at <code>192.168.1.100:7705</code></p>
<pre class="fragment">qutest *.py build/dpp localhost:7701 6605
</pre><p>runs "qutest" (<b>installed with pip</b>) to execute the test scripts (<code>*.py</code>) in the current directory, uses the host executable: <code>build/dpp</code>, and connects to QSPY at <code>localhost:7701</code>, using the local UDP port <code>6605</code></p>
<hr  />
<p><b>Next:</b> <a class="el" href="qutest_tut.html">QUTest&trade; Tutorial</a></p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
    <div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
      <ul>
        <li class="footer">
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; 2005-2021 Quantum Leaps</a> &nbsp;| &nbsp; <a title="help" href="help.html">Using Online Help</a>&nbsp;| &nbsp;<a title="Doxygen" href="http://www.doxygen.nl">Generated with Doxygen</a>&nbsp; | &nbsp;<b>QTools 6.9.3</b>
<hr class="footer"/><address class="footer"><small>
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; Quantum Leaps 2020</a> &nbsp;| &nbsp; <a title="help" href="help.html">Using Online Help</a>&nbsp;| &nbsp;<a title="Doxygen" href="http://www.doxygen.nl">Generated with Doxygen</a>&nbsp; | &nbsp;<b>QTools 6.9.3</b>
</small></address>
        </li>
      </ul>
    </div>
    <script src="custom.js"></script>
  </body>
</html>
