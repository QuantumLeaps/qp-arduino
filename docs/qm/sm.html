<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>QM: State Machines</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="ql-preview.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="ql-awesome.css" rel="stylesheet" type="text/css"/>
<link href="qm.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
  <div id="projectlogo">
    <a href="https://www.state-machine.com" title="Quantum Leaps"><img alt="Logo" src="logo_ql.png"/></a>
  </div>
   <div id="projectname">
    QM
    &nbsp;<span id="projectnumber">5.2.3</span>
   </div>
   <div id="projectbrief">Model-Based Design Tool</div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;"
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('sm.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">State Machines </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><span class="prev_button"><a class="el" href="bm_lock.html">Locking Model Items</a></span><span class="next_button"><a class="el" href="sm_statechart.html">Working with Statecharts</a></span></p>
<p >QM&trade; provides extensive support for modern <a href="https://www.state-machine.com/fsm/#HSM" class="extern" target="_blank">Hierarchical State Machines (HSMs)</a> (UML Statecharts), which are perhaps the most effective and elegant technique of structuring event-driven systems. In fact, QM&trade; has been specifically designed for ease of diagramming HSMs and for generating efficient, production-quality code from them. </p>
<p >The most important innovation of HSMs over classical finite state machines (FSMs) is the hierarchical state nesting. The value of state nesting lies in avoiding repetitions, which are inevitable in the traditional "flat" FSM formalism and are the main reason for the "state-transition explosion" in FSMs. The semantics of state nesting allow substates to define only the differences of behavior from the superstates, thus promoting sharing and reusing behavior.</p>
<dl class="section note"><dt>Note</dt><dd>The Quantum Leaps Application Note <a href="https://www.state-machine.com/doc/AN_Crash_Course_in_UML_State_Machines.pdf" class="extern" target="_blank"><b>A Crash Course in UML State Machines</b></a> introduces the main state machine concepts backed up by examples.<br  />
 <div class="image">
<img src="AN_Crash_Course_in_UML_State_Machines.gif" alt=""/>
<div class="caption">
Application Note: A Crash Course in UML State Machines</div></div>
 </dd></dl>
<p>This section focuses primarily on working with <b>state machine diagrams</b>, while the section <a class="el" href="ce_sm.html">Generating State Machine Code</a> will cover generating code from state machines. Of course, these two aspects are related, so even while "simply drawing" state machine diagrams, you will need to take code generation into account.</p>
<dl class="section note"><dt>Note</dt><dd>The section <a class="el" href="bm_diagram.html">Working with Diagrams</a> describes generic operations applicable to any diagram type, such as <a class="el" href="bm_diagram.html#bm_diagram_open">opening</a>, <a class="el" href="bm_diagram.html#bm_diagram_close">closing</a>, <a class="el" href="bm_diagram.html#bm_diagram_scroll">scrolling</a>, <a class="el" href="bm_diagram.html#bm_diagram_pan">panning</a>, and <a class="el" href="bm_diagram.html#bm_diagram_zoom">zooming</a> a diagram. The section <a class="el" href="sm_statechart.html">Working with Statecharts</a> describes specific operations applicable to statecharts (UML state diagrams).</dd></dl>
<div style="clear:both;"></div><h1><a class="anchor" id="sm_class"></a>
State Machine Base Classes</h1>
<p >In QM&trade; a State Machine can be associated only with a <a class="el" href="bm_class.html">class</a> that is a direct or indirect subclass of the <a class="el" href="bm_model.html#bm_qp_item">QP Framework</a> base class <b>QHsm</b>, shown at the top of the <a href="http://en.wikipedia.org/wiki/Class_(computer_programming)" class="extern" target="_blank">class diagram</a> <a class="el" href="sm.html#sm_super">below</a>.</p>
<p ><a class="anchor" id="sm_super"></a></p><div class="image">
<img src="qp_sm.gif" alt=""/>
</div>
  <div class="caption"><center><b>State Machine Classes in QP 5.8+</b></center></div><p >The <span style="background-color:#aaf;"> <b>QHsm</b> </span> base class provides the basic interface <code>init()</code> and <code>dispatch()</code> for initializing a state machine and for dispatching events to it, respectively. The specific implementations of the state machine interface in the <code>QHsm</code> base class and its subclasses, such as <b>QActive</b>, <b>QMsm</b>, and <b>QMActive</b>, determine the <a class="el" href="ce_sm.html">state machine implementation strategy</a> that QM&trade; will apply to generate code.</p>
<dl class="section note"><dt>Note</dt><dd>QM&trade; supports <b>classes</b> and <b>inheritance</b> regardless of the target programming language, which currently can be either <b>C</b> or <b>C++</b>. The <a href="https://www.state-machine.com/doc/AN_Simple_OOP_in_C.pdf" class="extern" target="_blank">Application Note "Simple Object-Oriented Programming in C"</a> describes how the <a href="https://www.state-machine.com/qpc" class="extern" target="_blank">QP/C</a> and <a href="https://www.state-machine.com/qpn" class="extern" target="_blank">QP-nano</a> frameworks as well as the QM&trade; code generator implement <em>classes</em> and <em>inheritance</em> in portable <b>ISO C</b>.</dd></dl>
<h2><a class="anchor" id="sm_class_qhsm"></a>
The QHsm-Style State Machines</h2>
<p >The <span style="background-color:#AAF;"> <b>QHsm</b> and <b>QActive</b> </span> classes from the <a class="el" href="sm.html#sm_class">class diagram above</a> implement the <a class="el" href="ce_sm.html#ce_qhsm_strategy">The QHsm/QActive-Style Implementation Strategy</a> that was originally designed for <b>manual coding</b> of HSMs, but now can also benefit from automatic code generation by QM&trade;</p>
<p >The screen shot below shows how to select the <b>superclass</b> property of your state-machine/active-object class in the <a class="el" href="bm_class.html#bm_class_prop">Class Property Sheet</a>, so that it uses the <code>QHsm/QActive</code>-Style state machine implementation strategy:</p>
<div class="image">
<img src="sm_qhsm-style.png" alt=""/>
</div>
  <div class="caption"><center><b>Selecting QHsm/QActive-Style Superclass</b></center></div><p >The main advantage of QHsm-style state machine implementation is that the code is <b>highly readable</b> and human-maintainable, but it requires discovering the <em>transition-sequences</em> (sequences of exit/entry/initial actions) at run-time as opposed to code-generation time. Also, the state nesting in QHsm-style state machines is limited to 5 levels of nesting.</p>
<dl class="section attention"><dt>Attention</dt><dd>Apart from changing the superclass property in the class Property Sheet, you also need to call the right superclass' <b>constructor</b> in the constructor of your state machine class. For direct subclasses of <span style="background-color:#AAF;"> <b>QActive</b> </span>, you need to call <code>QActive_ctor()</code> (for the QP/C and QP-nano frameworks) and <code>QActive::QActive()</code> (for the QP/C++ framework).</dd></dl>
<div class="image">
<img src="sm_qhsm-ctor.png" alt=""/>
</div>
  <div class="caption"><center><b>Calling the QActive_ctor() in the subclass' constructor</b></center></div><dl class="section remark"><dt>Remarks</dt><dd>You should consider <code>QHsm/QActive</code>-style state machines when you are still interested in <b>manual coding</b> or maintaining your state machines. (But then you will be working against the strictly <a class="el" href="index.html#ab_special">forward-engineering nature</a> of QM&trade;)</dd></dl>
<h2><a class="anchor" id="sm_class_qmsm"></a>
QMsm/QMActive-Style State Machines</h2>
<p >The <span style="background-color:#FAA;"> <b>QMsm</b> and <b>QMActive</b> </span> classes from the <a class="el" href="sm.html#sm_class">class diagram above</a> re-implement the state machine interface and thus provide an alternative <a class="el" href="ce_sm.html#ce_qmsm_strategy">QMsm/QMActive-Style Implementation Strategy</a> that is more efficient than the <a class="el" href="sm.html#sm_class_qhsm">QHsm-style strategy</a>, but requires the assistance of the QM&trade; tool (as an advanced "state machine compiler") to generate the complete <em>transition-sequences</em> at <em>code-generation</em> time. The resulting code is still <b>human-readable</b>, but is <b>not</b> suitable for manual coding or maintaining.</p>
<p >The screen shot below shows how to select the <b>superclass</b> property of your state-machine/active-object class in the <a class="el" href="bm_class.html#bm_class_prop">Class Property Sheet</a>, so that it uses the QMsm/QMActive-Style state machine implementation strategy:</p>
<div class="image">
<img src="sm_qmsm-style.png" alt=""/>
</div>
  <div class="caption"><center><b>Selecting QMsm/QMActive-Style Superclass</b></center></div><p >The lab tests indicate that the <code>QMsm/QMActive</code>-style state machines can be about twice as fast as the <code>QHsm</code>-style state machines (see the <a class="el" href="sm.html#sm_class_qhsm">next section</a> below). Additionally, the <code>QMsm/QMActive</code>-style state machines require less runtime support (smaller event processor) and use about 70% less stack space for the <code>dispatch()</code> operation than <code>QHsm/QActive</code>-style state machines. Also, the state nesting in QMsm-style state machines is no longer limited (nesting levels as high as 10 levels have been tested).</p>
<dl class="section attention"><dt>Attention</dt><dd>Apart from changing the superclass property in the class Property Sheet, you also need to call the right superclass' <b>constructor</b> in the constructor of your state machine class. For direct subclasses of <span style="background-color:#FAA;"> <b>QMActive</b> </span>, you need to call <code>QMActive_ctor()</code> (for the QP/C framework) and <code>QMActive::QMActive()</code> (for the QP/C++ framework).</dd></dl>
<div class="image">
<img src="sm_qmsm-ctor.png" alt=""/>
</div>
  <div class="caption"><center><b>Calling the QMActive_ctor() in the subclass' constructor</b></center></div><dl class="section remark"><dt>Remarks</dt><dd>The <code>QMsm/QMActive</code>-style state machines are generally recommended over the older <code>QHsm/QActive</code>-style state machines described <a class="el" href="sm.html#sm_class_qhsm">above</a>.</dd></dl>
<h1><a class="anchor" id="sm_toolbox"></a>
State Machine Toolbox</h1>
<p >When a State Machine diagram is active, the <a class="el" href="sm.html#sm_toolbox">State Machine Toolbox</a> displays a specific collection of tools for <b>adding</b> new shapes to the active State Machine.</p>
<dl class="section note"><dt>Note</dt><dd>The State Diagram Toolbox is <b>enabled</b> only when a state diagram is the active MDI window and the model is <a class="el" href="bm_lock.html">unlocked</a> (<span class="img unlock"></span>). If the Toolbox is <span class="highlight">invisible</span>, you need to show it in the <span class="menu"> View-&gt;Draw Toolbar</span> menu.</dd></dl>
<div style="clear:both;"></div><p >The usage of the tools in the State Diagram Toolbox is explained in the sections pertaining to the corresponding state machine elements:</p>
<ul>
<li><span class="img state"></span> <a class="el" href="sm_state.html">Add State</a></li>
<li><span class="img tran"></span> <a class="el" href="sm_tran.html">Add Transition</a></li>
<li><span class="img choice"></span> <a class="el" href="sm_choice.html">Add Choice Segment</a></li>
<li><span class="img initial"></span> <a class="el" href="sm_init.html">Add Initial Transition</a></li>
<li><span class="img history"></span> <a class="el" href="sm_hist.html">Add Transition to History</a></li>
<li><span class="img submachine"></span> <a class="el" href="sm_subm.html">Add Submachine Diagram</a></li>
<li><span class="img ep_seg"></span> <a class="el" href="sm_epseg.html">Add Entry-Point Segment</a></li>
<li><span class="img xp"></span> <a class="el" href="sm_xp.html">Add eXit-Point</a></li>
<li><span class="img sm_state"></span> <a class="el" href="sm_smstate.html">Add Submachine State</a></li>
<li><span class="img xp_seg"></span> <a class="el" href="sm_xpseg.html">Add eXit-Point Segment</a></li>
</ul>
<p ><span class="prev_button"><a class="el" href="bm_lock.html">Locking Model Items</a></span><span class="next_button"><a class="el" href="sm_statechart.html">Working with Statecharts</a></span> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.2-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; 2005-2022 Quantum Leaps</a> &nbsp;|&nbsp; <a title="help" href="help.html">Using Online Help</a> &nbsp;|&nbsp; <b>QM 5.2.3</b> &nbsp;|&nbsp; Updated on Wed Nov 16 2022
<hr class="footer"/><address class="footer"><small>
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; 2005-2022 Quantum Leaps</a> &nbsp;|&nbsp; <a title="help" href="help.html">Using Online Help</a> &nbsp;|&nbsp; <b>QM 5.2.3</b> &nbsp;|&nbsp; Updated on Wed Nov 16 2022
</small></address>
    </li>
  </ul>
</div>
</body>
</html>
