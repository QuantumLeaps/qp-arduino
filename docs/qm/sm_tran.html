<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>QM: Working with Transitions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="ql-preview.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="ql-awesome.css" rel="stylesheet" type="text/css"/>
<link href="qm.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
  <div id="projectlogo">
    <a href="https://www.state-machine.com" title="Quantum Leaps"><img alt="Logo" src="logo_ql.png"/></a>
  </div>
   <div id="projectname">
    QM
    &nbsp;<span id="projectnumber">5.2.3</span>
   </div>
   <div id="projectbrief">Model-Based Design Tool</div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;"
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('sm_tran.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Working with Transitions </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><span class="prev_button"><a class="el" href="sm_state.html">Working with States</a></span><span class="next_button"><a class="el" href="sm_choice.html">Working with Choice Segments</a></span></p>
<h1><a class="anchor" id="sm_tran_reg"></a>
Regular Transitions</h1>
<p >Any change in handling of events requires a change of state, that is, a <b>state transition</b>. Such <b>state-to-state transitions</b> are represented as lines that originate on an edge of the <em>source state</em> and terminate with an arrow (<span class="img tran_state"></span>) on an edge of the <em>target state</em>. </p>
<div class="image">
<img src="sm_tran_source.png" alt=""/>
<div class="caption">
State-to-State Transition</div></div>
    <dl class="section note"><dt>Note</dt><dd>All connectors in QM&trade; diagrams, such as transitions, consist of <b>rectilinear segments</b> only (strictly horizontal or strictly vertical lines). The usability studies, such as public transport diagrams (e.g., Back's maps), show that restricting a diagram to straight segments running only horizontally and vertically, (and sometimes diagonally) greatly improve the readability of the diagrams.</dd></dl>
<h1><a class="anchor" id="sm_tran_intern"></a>
Internal Transitions</h1>
<p >However, often you only need to simply <em>react</em> to an event (by executing some actions) <em>without</em> changing states. In UML such a situation should be modeled with <b>internal transitions</b>. Internal transitions are represented in UML as text inside the state compartment (see part (A) of the figure below).</p>
<div class="image">
<img src="sm_intern.png" alt=""/>
<div class="caption">
Internal Transitions in UML (A) and in QM&trade;(B)</div></div>
    <p >In QM&trade; internal transitions are represented as a transition without a target (see part (B) of the figure above). Visually, the end of such transition shows as a small rectangle (<span class="img tran_internal"></span>) instead of an arrow (<span class="img tran_state"></span>).</p>
<dl class="section note"><dt>Note</dt><dd>The QM&trade; representation of internal transitions differs from the <a href="http://en.wikipedia.org/wiki/UML_state_machine#Internal_transitions" class="extern" target="_blank">standard UML notation</a> and therefore is a <span class="highlight">"non-normative UML"</span>.</dd></dl>
<div class="image">
<img src="sm_tran_self.png" alt=""/>
<div class="caption">
Internal Transition and Self-Transition in QM</div></div>
    <dl class="section note"><dt>Note</dt><dd>Internal transitions are <b>different</b> from <em>self-transitions</em> (loops starting and terminating on the same state), because self-transitions cause exit of the state (execution of exit actions) and re-entry to the state (execution of entry actions followed by optional initial transitions), whereas internal transitions never cause state exit or entry.</dd></dl>
<h1><a class="anchor" id="sm_tran_add"></a>
Adding a Transition</h1>
<dl class="section note"><dt>Note</dt><dd>In order to add a transition, you first need to <a class="el" href="bm_diagram.html#bm_diagram_open">open</a> a state diagram, which needs to have at least one <a class="el" href="sm_state.html">state</a>. Also, the State Machine diagram must be <a class="el" href="bm_lock.html">unlocked</a> (<span class="img unlock"></span>).</dd></dl>
<p>Make sure that the State Machine subwindow is active. In the <a class="el" href="sm.html#sm_toolbox">State Machine Toolbox</a> click on the <span class="img tran">Transition</span> tool and <em>release</em> the mouse button (don't drag the tool off the toolbar). At this point, when you hover the mouse over the active state diagram, the mouse pointer changes to the transition tool with the "forbidden" icon (<span class="img forbidden"></span>), because a transition can only be added to an <b>edge</b> of a state. When you hover the mouse over a state edge, the mouse pointer changes to the transition tool with the anchor (<span class="img anchor"></span>). To add the transition at this <b>source</b> state, press the mouse button and drag the transition end out. As you drag the transition, the mouse pointer changes to a hand and the transition end takes the shape of a square (<span class="img tran_internal"></span>).</p>
<dl class="section attention"><dt>Attention</dt><dd>As shown in the animations below, a transition (state-to-state or internal) in QM&trade; is always added to the <b>Source State</b>, meaning that it shows up in the <a class="el" href="ui_explorer.html">Model Explorer</a> as a child of the <b>Source State</b> item.</dd></dl>
<h2><a class="anchor" id="sm_tran_add-internal"></a>
Adding Internal Transition</h2>
<p >If you drop the transition end when it still shows as a square (<span class="img tran_internal"></span>), the transition will become an <b>internal transition</b> (a.k.a. state reaction). The following animation shows how to add an internal transition:</p>
<p ><a class="anchor" id="sm_tran_anim"></a></p><div class="image">
<img src="sm_tran_internal-add.gif" alt=""/>
<div class="caption">
Adding an Internal Transition</div></div>
<dl class="section note"><dt>Note</dt><dd>As described in section <a class="el" href="sm_tran.html#sm_tran_type">Changing Transition Type</a>, you can very easily change an <em>internal transition</em> into a regular <em>state-to-state transition</em> or vice versa.</dd></dl>
<h2><a class="anchor" id="sm_tran_add-state"></a>
Adding State-to-State Transition</h2>
<p >To add a regular <b>state-to-state transition</b>, you need to drag the transition end to an edge of the <b>target</b> state. As you drag the transition end over a state edge (which could be the source state), the mouse pointer changes to a hand shape with an anchor (<span class="img anchor"></span>) and the transition end takes the shape of an arrow. If this is the desired <b>target</b> state, drop the transition end at this point. The following animation shows how to add a state-to-state transition:</p>
<div class="image">
<img src="sm_tran_state-add.gif" alt=""/>
<div class="caption">
Adding a State-to-State Transition</div></div>
<h1><a class="anchor" id="sm_tran_prop"></a>
Transition Property Sheet</h1>
<p ><span class="img tran">Transition</span> item can be configured by the Transition-Specific <a class="el" href="ui_prop.html">Property Sheet</a>.</p>
<div class="image">
<img src="sm_tran_prop.png" alt=""/>
<div class="caption">
Transition Property Sheet</div></div>
<p >The Transition property sheet contains the following properties:</p><ul>
<li><a class="el" href="sm_tran.html#sm_tran-trig">Transition Trigger</a></li>
<li><a class="el" href="sm_tran.html#sm_tran-target">Transition Target</a> (not editable&mdash;determined geometrically)</li>
<li><a class="el" href="sm_tran.html#sm_tran-act">Transition Action</a></li>
</ul>
<h2><a class="anchor" id="sm_tran-trig"></a>
Transition Trigger</h2>
<p >Every transition in QM&trade; must have an explicit <b>trigger</b>, which is the name of the <b>signal</b> of the event that triggers the transition (NOTE: QM&trade; does <b>not</b> support trigger-less <em>"anonymous transitions"</em>). The <em>trigger</em> shows up in the <a class="el" href="sm_tran.html#sm_tran_text">Text Box</a> associated with the Transition.</p>
<p >The <em>trigger</em> property must be a legal symbolic constant representing the <b>signal</b> of the triggering event. Typically, the event signals are enumerated constants, and by the C convention are all in uppercase, for example: <code>TIMEOUT</code>, <code>OPEN</code>, <code>CLOSE</code>, etc.</p>
<dl class="section attention"><dt>Attention</dt><dd>By convention, QM&trade; <a class="el" href="ce_sm.html">code generator</a> appends the suffix <b><code>_SIG</code></b> to the <em>trigger</em> property you type into the Property Editor. For example, triggers <code>TIMEOUT</code>, <code>OPEN</code>, and <code>CLOSE</code> will appear in the generated code as <code>TIMEOUT</code><b><code>_SIG</code></b>, <code>OPEN</code><b><code>_SIG</code></b>, and <code>CLOSE</code><b><code>_SIG</code></b>, respectively.</dd></dl>
<h3><a class="anchor" id="sm_tran_trig-list"></a>
Trigger List</h3>
<p >The <em>trigger</em> property might also be a <b>list</b> of event <em>signals</em> that trigger the transition, which is a shorthand notation for a group of transitions that all target the same state and execute the same actions. For example, you might provide a single <em>trigger</em> property as: <code>"TIMEOUT, OPEN, CLOSE"</code>, which means that <b>all</b> of the listed signals will trigger the transition.</p>
<div class="image">
<img src="sm_tran_list.png" alt=""/>
<div class="caption">
Transitions with a Trigger List</div></div>
<dl class="section note"><dt>Note</dt><dd>The QM&trade; <a class="el" href="ce_sm.html">code generator</a> will convert the trigger list into a list of <code>case</code> statements that "fall through" into each other.</dd></dl>
<h3><a class="anchor" id="sm_tran_CATCH_ALL"></a>
CATCH_ALL Trigger</h3>
<p >As an extension to the UML, QM&trade; supports also a special type of <b>CATCH_ALL</b> transition trigger. This trigger means that the transition will be trigger by any event that is <b>not</b> handled explicitly by any other transition in the state.</p>
<div class="image">
<img src="sm_tran_CATCH_ALL.png" alt=""/>
<div class="caption">
CATCH_ALL Transition</div></div>
<dl class="section note"><dt>Note</dt><dd>Obviously, it does not make sense to have more than one <code>CATCH_ALL</code> transition per state. The QM&trade; <a class="el" href="ce_sm.html">code generator</a> will report an error if encounters multiple <code>CATCH_ALL</code> triggers in a given state.</dd></dl>
<h2><a class="anchor" id="sm_tran-target"></a>
Transition Target</h2>
<p >The <b>target</b> property is not editable directly, but rather it is determined geometrically by the end-point of the transition. For <em>state-to-state transitions</em>, the <em>target</em> property lists the target state at which the end-point (<span class="img tran_state"></span>) terminates. For <em>internal transitions</em> with the square end-point (<span class="img tran_internal"></span>), the <em>target</em> property shows <code>internal</code>.</p>
<h2><a class="anchor" id="sm_tran-act"></a>
Transition Action</h2>
<p >A Transition can have an optional <b>action</b> property, which consists of two entries: <em>pseudocode</em> and <em>code</em> (see <a class="el" href="sm_tran.html#sm_tran_prop">Transition Property Sheet</a>). Only the <b>code</b> part of the <em>action</em> property is relevant for the <a class="el" href="ce.html">code generation</a>. The <b>pseudocode</b> field is designed only to be displayed in the diagram to avoid clutter by minimizing the amount of text to display next to the transition shape.</p>
<dl class="section attention"><dt>Attention</dt><dd>The <b>Pseudocode</b> entry of the <em>action</em> property is intended only for displaying in the diagram and has <span>no implications for code generation</span>. Only the <b>Code</b> entry of the <em>action</em> property matters for code generation.</dd></dl>
<p><a class="anchor" id="sm_tran_e-ptr"></a><b>Pointer to the Triggering Event (<span class="highlight">e</span>):</b> The transition action <b>code</b> often needs to access the triggering event, which is provided as the <span>e</span> pointer of the type <code>(QEvt const * const)</code>. This means that you have <b>read-only</b> access to the event, and you cannot change the <code>e</code> pointer.</p>
<p ><a class="anchor" id="sm_tran_e-par"></a><b>Accessing Event Parameters:</b> To access <b>event parameters</b> of the triggering event, you typically need to <b>downcast</b> the event pointer <b>e</b>. This downcast is always based on the transition <b>trigger</b> (signal of the triggering event, see <a class="el" href="sm_tran.html#sm_tran-trig">Transition Trigger</a>), which means that you must always know the <b>event type</b> (event class) associated with the trigger.</p>
<h1><a class="anchor" id="sm_tran_text"></a>
Transition Text Box</h1>
<p >Once the transition item is <em>selected</em> as the <a class="el" href="ui_curr_item.html">Current Item</a>, you can see the boundary of the <b>Text Box</b> associated with the transition. The Text Box allows you to <b>move</b> and <b>resize</b> the transition text by dragging it around or dragging the Text Box Handle (see the screen animation below).</p>
<div class="image">
<img src="sm_tran_text.png" alt=""/>
<div class="caption">
Transition Text Box</div></div>
<p >The Text Box allows you to <b>move</b> and <b>resize</b> the transition text by dragging it around or dragging the Text Box Handle (see the screen animation below).</p>
<div class="image">
<img src="sm_tran-text.gif" alt=""/>
<div class="caption">
Moving and Resizing the Transition Text Box</div></div>
<p ><a class="anchor" id="sm_tran-text"></a></p><dl class="section note"><dt>Note</dt><dd>The actual algorithm QM uses to display the action text in the text box is as follows: If both the <b>pseudocode</b> and <b>code</b> entries in the <a class="el" href="sm_tran.html#sm_tran_prop">Transition Property Sheet</a> are empty, the corresponding action is considered undefined and the Text Box associated with the transition shows only the <code>&amp;lt;TRIGGER&amp;gt;/</code> string. If the <em>pseduocode</em> entry is not empty, regardless of the contents of the <em>code</em> entry, the <em>pseudocode</em> is displayed in the <em>same line</em> as the <code>&amp;lt;TRIGGER&amp;gt;/</code> string. Finally, if the <em>pseudocode</em> is empty, but the <em>code</em> entry is not empty, the <em>code</em> is displayed in the Text Box of the transition, however, the actual code is displayed in a line <b>below</b> the <code>&amp;lt;TRIGGER&amp;gt;/</code> string. Of course, to see the text, you need to sufficiently expand the Text Box of the transition, as shown in the animation above.</dd></dl>
<h1><a class="anchor" id="sm_tran_move"></a>
Moving Transitions</h1>
<p >To move a transition, either within the original source state or to a <em>different</em> source state, you need to hover the mouse over the <b>source-end</b> of the transition until the mouse cursor changes to "hand with an anchor" (<span class="img anchor"></span>). At this point you can start dragging the source-end to a different state edge, which could be a <em>different</em> state.</p>
<div class="image">
<img src="sm_tran-move.gif" alt=""/>
<div class="caption">
Moving Transition</div></div>
<h1><a class="anchor" id="sm_tran_type"></a>
Changing Transition Type</h1>
<p >At any point, you can very easily change an <em>internal transition</em> into a regular <em>state-to-state transition</em> by simply dragging the square end (<span class="img tran_internal"></span>) and "anchoring" it at an edge of a state, at which point it becomes an arrow (<span class="img tran_state"></span>). This is one of the many benefits of the "non-normative" transition notation used in QM&trade;.</p>
<h1><a class="anchor" id="sm_tran_routing"></a>
Routing Transitions</h1>
<p >QM&trade; allows you to route your transitions (all connectors, in fact) any way you like. You can create any number of rectilinear segments and you can move them around. The following animation shows how the segments on both ends can be used to create new edges, how to move them, and how to remove segments.</p>
<div class="image">
<img src="sm_route-anim.gif" alt=""/>
<div class="caption">
Routing a transition in QM&trade;</div></div>
    <p >One of the primary design objectives in QM&trade; was to respect your design decisions as much as possible and avoid the need to "fight the tool". In this respect, nothing is more frustrating than a tool that suddenly changes the arrangement of your transitions, after you spent hours routing them exactly the way you like. QM&trade; will never do that. Instead, QM&trade; will change at most 2 first or last transition segments attached, depending if you are moving the beginning or end of the transition.</p>
<div class="image">
<img src="sm_tran-anim.gif" alt=""/>
<div class="caption">
QM Preserves the layout of a transition</div></div>
    <h1><a class="anchor" id="sm_tran_guards"></a>
What About Guards?</h1>
<p >A very important feature of state transitions in UML is the support for <b>guard conditions</b> (often simply called "guards"). A guard condition is a Boolean expression that can be associated with a transition, which means that the transition should be taken only when the guard dynamically evaluates to TRUE. If the guard evaluates to FALSE, the transition is <em>not</em> taken and any action(s) associated with the transition are <em>not</em> executed.</p>
<p >In QM&trade; state transitions do <b>not</b> accept guard conditions. Instead, you can attach any number of <a class="el" href="sm_choice.html">choice segments</a> to the end of a transition, which creates alternative transition path(s) evaluated dynamically at run-time. You can even attach choice-segments to choice-segments to build even more complex transition paths. All this provides actually a <em>more powerful</em> and intuitive mechanism than simple "guards" on transitions.</p>
<div class="image">
<img src="sm_guard.png" alt=""/>
<div class="caption">
UML Notation for a Transition with a Guard (A) and a Transition with a Choice Pseudostate (B)</div></div>
<dl class="section note"><dt>Note</dt><dd>The UML supports the concept of a "choice-pseudostate", which is an alternative to guards on transitions. QM&trade; supports the UML "choice-pseudostates" in the form of <a class="el" href="sm_choice.html">choice segments</a>. The concept and notation for "choice pseudostate" (panel (B) in the diagram above) <b>is</b> compliant with UML.</dd></dl>
<p><span class="prev_button"><a class="el" href="sm_state.html">Working with States</a></span><span class="next_button"><a class="el" href="sm_choice.html">Working with Choice Segments</a></span> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.2-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="sm.html">State Machines</a></li>
    <li class="footer">
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; 2005-2022 Quantum Leaps</a> &nbsp;|&nbsp; <a title="help" href="help.html">Using Online Help</a> &nbsp;|&nbsp; <b>QM 5.2.3</b> &nbsp;|&nbsp; Updated on Wed Nov 16 2022
<hr class="footer"/><address class="footer"><small>
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; 2005-2022 Quantum Leaps</a> &nbsp;|&nbsp; <a title="help" href="help.html">Using Online Help</a> &nbsp;|&nbsp; <b>QM 5.2.3</b> &nbsp;|&nbsp; Updated on Wed Nov 16 2022
</small></address>
    </li>
  </ul>
</div>
</body>
</html>
