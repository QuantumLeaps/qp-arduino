<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>QTools: QUTest&trade; Script Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="ql.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
  <a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">
    <img id="logo" src="img/logo_ql.png" alt="Quantum Leaps">
  </a>
  <span id="projectname">QTools</span>
  <span id="projectnumber">6.9.3</span>
           <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)"
               onblur="searchBox.OnSearchFieldFocus(false)"
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;"
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('qutest_script.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0"
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">QUTest&trade; Script Reference </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#qutest_script-run">Running the Test Scripts</a></li>
<li class="level1"><a href="#qutest_dsl">QUTest&trade; Testing DSL</a><ul><li class="level2"><a href="#qutest_dsl-preamble">Preamble</a></li>
<li class="level2"><a href="#qutest_dsl-tests">Tests</a></li>
<li class="level2"><a href="#qutest_dsl-commands">Commands</a></li>
</ul>
</li>
<li class="level1"><a href="#qutest_qspy">Categories of QSPY Output</a></li>
</ul>
</div>
<div class="textblock"><p>A QUTest <em>test script</em> contains a group of related tests (a <em>test group</em>). The basic job of these tests is to send commands to the <a class="el" href="qutest_fixture.html">test fixture</a> running in the Target and to compare the <a class="el" href="qspy_text.html">QSPY textual output</a> produced by the Target with the <a href="https://www.state-machine.com/glossary#test_expectation" class="extern"><b>expectations</b></a> of the tests. </p>
<p>The QUTest <em>test scripts</em> are executed in the host by the "QUTest front-end" that communicates with the <a class="el" href="qspy.html">QSPY</a> host application via the <a class="el" href="qspy_udp.html">UDP interface</a>. The "QUTest front-end" is itself implemented in <a href="https://www.python.org/"><b>Python</b></a> (Python 3.3+).</p>
<p><img src="logo_python3.gif" alt="" class="inline"/></p>
<h1><a class="anchor" id="qutest_script-run"></a>
Running the Test Scripts</h1>
<dl class="section note"><dt>Note</dt><dd>To run any test script(s), you first need to make sure that the <a class="el" href="qspy.html">QSPY</a> console application (version 6.x or higher) is running. Once QSPY is running, you can "attach" to the UDP socket and start communicating with the QSPY back-end or to the Target (through QSPY).</dd></dl>
<p>The Python test scripts are executed by the Python module <span class="img file_py">qtools/qspy/py/qutest.py</span>, with the following usage:</p>
<pre class="fragment">python3 &lt;qutest-dir&gt;qutest.py [-x] [test-scripts] [host_exe] [qspy_host[:udp_port]] [qspy_tcp_port]
</pre><p>where:<br  />
<code>&lt;qutest-dir&gt;</code> is the directory with the <code>qutest.py</code> script<br  />
 </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">[test_scripts]</td><td>optional specification of the Python test scripts to run. If not specified, qutest will try to run all *.py files in the current directory as test scripts</td></tr>
    <tr><td class="paramname">[host_exe]</td><td>optional specification of the host executable to launch for testing embedded code on the host computer. If <code>host_exe</code> is <b>not</b> specified, or is specified as a placeholder <code>""</code>, an embedded target is assumed. The special value <code>DEBUG</code> means that <code>qutest.py</code> will start in the <b>debug mode</b>, in which it will NOT launch the host executables and it will wait for the Target reset and other responses from the Target.</td></tr>
    <tr><td class="paramname">[qspy_host[:udp_port]]</td><td>optional host-name/IP-address:port for the host running the QSpy utility. If not specified, the default is localhost:7701.</td></tr>
    <tr><td class="paramname">[tcp_port]</td><td>optional the QSpy TCP port number for connecting host executables.</td></tr>
  </table>
  </dd>
</dl>
<p>Usage examples (for Windows):</p>
<pre class="fragment">python3 %QTOOLS%\qspy\py\qutest.py
python3 %QTOOLS%\qspy\py\qutest.py *.py
python3 %QTOOLS%\qspy\py\qutest.py *.py build\dpp.exe
python3 %QTOOLS%\qspy\py\qutest.py *.py build\dpp.exe 192.168.1.100:7705
python3 %QTOOLS%\qspy\py\qutest.py *.py "" localhost:7701 6605
python3 %QTOOLS%\qspy\py\qutest.py *.py DEBUG
python3 %QTOOLS%\qspy\py\qutest.py *.py DEBUG localhost:7701 6605
</pre><p>Usage examples (for Linux/MacOS):</p>
<pre class="fragment">python3 $(QTOOLS)/qspy/py/qutest.py
python3 $(QTOOLS)/qspy/py/qutest.py *.py
python3 $(QTOOLS)/qspy/py/qutest.py *.py build/dpp
python3 $(QTOOLS)/qspy/py/qutest.py *.py build/dpp 192.168.1.100:7705
python3 $(QTOOLS)/qspy/py/qutest.py *.py "" localhost:7701 6605
python3 $(QTOOLS)/qspy/py/qutest.py *.py DEBUG
python3 $(QTOOLS)/qspy/py/qutest.py *.py DEBUG localhost:7701 6605
</pre><h1><a class="anchor" id="qutest_dsl"></a>
QUTestâ„¢ Testing DSL</h1>
<p>The Python module <span class="img file_py">qtools/qspy/py/qutest.py</span> defines a small Domain Specific Language (DSL) for writing test scripts in Python. The structure of this DSL is very simple. Each test script consists of two sections:</p>
<h2><a class="anchor" id="qutest_dsl-preamble"></a>
Preamble</h2>
<p>The "preamble" section of a test script file specifies include scripts and defines callback functions common to all tests in this file. It can contain the following functions:</p>
<ul>
<li><a class="el" href="namespacequtest__dsl.html#a1e5777a9cd236612645088169cc07e9d" title="include python code in a test script">include()</a></li>
<li><a class="el" href="namespacequtest__dsl.html#aa40735b0e2865f928331d30798090ee2" title="callback function invoked after each Target reset">on_reset()</a></li>
<li><a class="el" href="namespacequtest__dsl.html#a72c6919e936aff35c5a88dc715bde8a0" title="callback function invoked at the beginning of each test">on_setup()</a></li>
<li><a class="el" href="namespacequtest__dsl.html#a9c3b042edef9cc4b018f45f2ab9f5be4" title="callback function invoked at the end of each test">on_teardown()</a></li>
</ul>
<p>The <code>on_...()</code> callback functions can call any of the <a class="el" href="qutest_script.html#qutest_dsl-commands">test commands</a>.</p>
<h2><a class="anchor" id="qutest_dsl-tests"></a>
Tests</h2>
<p>The "tests" section of a test script file contains the actual tests. Each test starts with the <a class="el" href="namespacequtest__dsl.html#a428afa0df76f435f6a7b3c201bdb846c" title="start a new test">test()</a> command and can contain any number of the <a class="el" href="qutest_script.html#qutest_dsl-commands">test commands</a>. The test continues until another <a class="el" href="namespacequtest__dsl.html#a428afa0df76f435f6a7b3c201bdb846c" title="start a new test">test()</a> command, or the <a class="el" href="namespacequtest__dsl.html#a7561fe7dd3150c85363087e8e7feb2aa" title="skip the tests following this command.">skip()</a> command.</p>
<ul>
<li><a class="el" href="namespacequtest__dsl.html#a428afa0df76f435f6a7b3c201bdb846c" title="start a new test">test()</a></li>
<li><a class="el" href="namespacequtest__dsl.html#a7561fe7dd3150c85363087e8e7feb2aa" title="skip the tests following this command.">skip()</a></li>
</ul>
<h2><a class="anchor" id="qutest_dsl-commands"></a>
Commands</h2>
<p>The commands that you can place in the tests (as well as inside the callback functions) are:</p>
<ul>
<li><a class="el" href="namespacequtest__dsl.html#a0489cc93c36a171881ff0c198e08f4f2" title="defines an expectation for the current test">expect()</a></li>
<li><a class="el" href="namespacequtest__dsl.html#a3ead8e3217c089e463fda6939fce6d9c" title="Send the QS Global Filter to the Target.">glb_filter()</a></li>
<li><a class="el" href="namespacequtest__dsl.html#ac0d43a3ce5873c15dadde9fef0b735ee" title="Send the Local Filter to the Target.">loc_filter()</a></li>
<li><a class="el" href="namespacequtest__dsl.html#a3329da8d0973a537dc71e2a6604b5fe2" title="Updates the Local Filter for a given AO in the Target.">ao_filter()</a></li>
<li><a class="el" href="namespacequtest__dsl.html#ac890232d1de79547ba5485953f84ac66" title="Set the Current-Object in the Target.">current_obj()</a></li>
<li><a class="el" href="namespacequtest__dsl.html#a67020ea4a88c04953559f967add2c17c" title="query the current object in the Target">query_curr()</a></li>
<li><a class="el" href="namespacequtest__dsl.html#a061dff11f10ad3fdf4ca5c8f118e39c1" title="trigger system clock tick in the Target">tick()</a></li>
<li><a class="el" href="namespacequtest__dsl.html#a24bbc89bd100f363a1988c3690764995" title="defines expectation for a Test Pause">expect_pause()</a></li>
<li><a class="el" href="namespacequtest__dsl.html#a511b1ad4434c13c4c70a8e20149cc812" title="sends the CONTINUE packet to the Target to continue a test">continue_test()</a></li>
<li><a class="el" href="namespacequtest__dsl.html#a6badcb644f2efeaf1da70e762a0821fe" title="executes a given command in the Target">command()</a></li>
<li><a class="el" href="namespacequtest__dsl.html#a9ae97d4f61d45c1296f51cc6c632916e" title="take the top-most initial transition in the current SM object in the Target">init()</a></li>
<li><a class="el" href="namespacequtest__dsl.html#afd0f42ed39bd1f6cdaee1e153176bd34" title="dispatch a given event in the current SM object in the Target">dispatch()</a></li>
<li><a class="el" href="namespacequtest__dsl.html#aa9a8d170b3adbe3fb03db4a199876336" title="post a given event to the current AO object in the Target">post()</a></li>
<li><a class="el" href="namespacequtest__dsl.html#a3e26471900a92b6fafa2d55099bd2562" title="publish a given event to subscribers in the Target">publish()</a></li>
<li><a class="el" href="namespacequtest__dsl.html#a8daad60d8c42f4b8bab8c440b06992a1" title="sends a Test-Probe to the Target">probe()</a></li>
<li><a class="el" href="namespacequtest__dsl.html#af4dcf1650f5a4e17a96c04a24cb9464b" title="peeks data in the Target">peek()</a></li>
<li><a class="el" href="namespacequtest__dsl.html#a3fb35bbc1071d49a9758de298a5269a1" title="pokes data into the Target.">poke()</a></li>
<li><a class="el" href="namespacequtest__dsl.html#a41370a14706532ccd2f612a3d702fb30" title="fills data into the Target.">fill()</a></li>
<li><a class="el" href="namespacequtest__dsl.html#a545b328b74868e098771c12493f7896a" title="packs data into binary string to be sent to QSPY.">pack()</a></li>
<li><a class="el" href="namespacequtest__dsl.html#a7682d6f87d60e3c7120fe908b7426ae7" title="get the test file name with path">test_file()</a></li>
<li><a class="el" href="namespacequtest__dsl.html#a800f760938c4c0cb2d2ff087b3f112dd" title="get the test directory (relative to the current directory)">test_dir()</a></li>
</ul>
<h1><a class="anchor" id="qutest_qspy"></a>
Categories of QSPY Output</h1>
<p>To write effective <em>test scripts</em> you need to understand the main categories of QSPY output, which are illustrated in the picture below:</p>
<p><img src="qspy_cat.png" alt="" class="inline" title="Categories of QSPY output"/></p>
<dl class="tag">
<dt>0</dt>
<dd>Information output generated internally by QSPY. This output is <em>not</em> sent to <em>test scripts</em>.  </dd>
<dt>1</dt>
<dd>Dictionary trace records generated by the Target. This output is <em>not</em> forwarded to <em>test scripts</em>.  </dd>
<dt>2</dt>
<dd>Acknowledgement trace records generated by the Target. This output <em>is</em> forwarded to <em>test scripts</em>, but is checked automatically and implicitly by the <em>test commands</em>.  </dd>
<dt>3</dt>
<dd>Trace records generated by the Target. This output <em>is</em> forwarded to <em>test scripts</em> and must be checked <b>explicitly</b> by test expectations.  </dd>
</dl>
<div style="clear:both;"></div><hr  />
<p><b>Next:</b> <a class="el" href="qview.html">QView&trade; Visualization &amp; Monitoring</a></p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
    <div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
      <ul>
        <li class="footer">
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; 2005-2021 Quantum Leaps</a> &nbsp;| &nbsp; <a title="help" href="help.html">Using Online Help</a>&nbsp;| &nbsp;<a title="Doxygen" href="http://www.doxygen.nl">Generated with Doxygen</a>&nbsp; | &nbsp;<b>QTools 6.9.3</b>
<hr class="footer"/><address class="footer"><small>
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; Quantum Leaps 2020</a> &nbsp;| &nbsp; <a title="help" href="help.html">Using Online Help</a>&nbsp;| &nbsp;<a title="Doxygen" href="http://www.doxygen.nl">Generated with Doxygen</a>&nbsp; | &nbsp;<b>QTools 6.9.3</b>
</small></address>
        </li>
      </ul>
    </div>
    <script src="custom.js"></script>
  </body>
</html>
